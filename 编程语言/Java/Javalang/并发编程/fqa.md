## 基本原理

##### 定义：并发、并行

> 《深入理解计算机系统》 第 508 页

**什么是并发、并发流、并发地运行？**

多个逻辑控制流在时间上重叠的现象，称为并发。这些流称为并发流。它们并发地运行。

**什么是并行、并行流、并行的运行？**

并行是并发的真子集。

多个逻辑控制流并发地运行在不同的处理器核或不同的计算机上的现象，称为并行。这些流称为并行流。它们并行地运行，且并行的执行。

**什么是逻辑控制流？**

用调试器单步执行程序时，看到的 PC 值序列，称为逻辑控制流。

进程为每个程序提供了一种假象，好像程序在独占地使用处理器。如果用调试器单步执行程序，我们会看到一系列的程序计数器值，这些值唯一地对应于程序的指令。这个 PC 值序列，称为逻辑控制流，简称逻辑流。



##### 定义：进程、线程、协程

> 《深入理解计算机系统》



**什么是进程？**

进程是操作系统对一个正在运行的程序的一种抽象，一个执行中程序的实例。在一个系统上可以同时运行多个进程，而每个进程都好像在独占地使用硬件。

**什么是上下文？**

进程运行所需的所有状态信息，比如 PC、寄存器文件的当前值、主存内容。操作系统会保持跟踪上下文。

**什么是上下文切换？**

上下文切换，是操作系统实现交错执行的机制。

在任何一个时刻，单处理器系统都只能执行一个进程的代码。当操作系统决定要把控制权从当前进程转移到某个新进程时，就会进行上下文切换。

也就是，保存当前进程的上下文，恢复新进程的上下文，然后将控制权传递到新进程。新进程就会从它上次停止的地方开始。

进程的上下文切换，是由内核管理的。当应用程序需要操作系统的某些操作时，它就执行一条特殊的系统调用指令，将控制权传递给内核。然后内核执行被请求的操作并返回应用程序。

**什么是内核？**

kernel，内核，即操作系统内核，是操作系统代码常驻主存的部分。

内核不是一个独立的进程。相反，它是系统管理全部进程所用代码和数据结构的集合。

**什么是线程？**

线程是进程的执行单元。一个进程可以由多个线程组成，每个线程都运行在进程的上下文中，并共享同样的代码和全局数据。

**什么是协程？**



#### 线程

##### 线程创建

**如何创建一个线程？**

**线程创建**只有一种方式，调用 `Thread` 类的构造函数。

**线程执行单元实现**有两种方式。一种重写 `Thread#run()` 方法，一种实现 `Runnable#run` 方法。推荐第二种方式，以解耦线程的控制逻辑和业务执行逻辑。

![Thread-constract](images\Thread-constract.png)



##### `Thread` 类

**如何启动一个线程？**

调用 `Thread#start()` 方法。

**调用 `start` 方法后，到底进行了什么操作？**

状态检查；将线程添加到组；启动线程。 Java 虚拟机调用该线程的 `run` 方法。

![Thread-start](images\Thread-start.png)

使该线程开始执行； Java 虚拟机调用该线程的 `run` 方法。
结果是两个线程同时运行：当前线程（从对 `start` 方法的调用返回）和另一个线程（执行其 `run` 方法）。
多次启动一个线程是非法的。特别是，线程一旦完成执行就可能不会重新启动。

此方法不会被主方法线程或由 VM 创建/设置的 `system` 组线程调用。将来添加到此方法的任何新功能也可能必须添加到 VM。`0` 状态值对应于状态 `NEW`。

通知组该线程即将启动，以便可以将其添加到组的线程列表中，并且可以减少组的未启动计数。





**`run` 方法和 `start` 方法有什么关系？**

##### 线程生命周期





#### 线程池

##### 原理

> 讲讲线程池原理



##### 组成要素

> 一个功能完善的线程池应该具备哪些要素？

任务队列、线程数量管理、拒绝策略、线程工厂等。

